// Generated by CoffeeScript 1.6.2
(function() {
  var PVMAjax;

  PVMAjax = (function() {
    var host;

    host = {
      protocol: window.location.protocol,
      host: window.location.host,
      route: "pvm",
      port: "8080"
    };

    function PVMAjax(username, password, pvmProtocol, pvmURL, pvmRoute, pvmPort) {
      this.username = username;
      this.password = password;
      this.pvmProtocol = pvmProtocol;
      this.pvmURL = pvmURL;
      this.pvmRoute = pvmRoute;
      this.pvmPort = pvmPort;
      this.methods = ko.observableArray();
      this.descriptions = new Object();
      this.initialize();
    }

    PVMAjax.prototype.successFunction = function(r) {
      console.log('success');
      return console.log(r);
    };

    PVMAjax.prototype.errorFunction = function(r) {
      console.log('error');
      return console.log(r);
    };

    PVMAjax.prototype.initialize = function() {
      return $.ajax({
        dataType: 'json',
        url: window.location.protocol + '//' + window.location.host + '/init',
        data: {
          username: this.username,
          password: this.password,
          protocol: this.pvmProtocol,
          host: this.pvmURL,
          route: this.pvmRoute,
          port: this.pvmPort
        },
        success: this.getMethods()
      });
    };

    PVMAjax.prototype.bindDescriptions = function() {
      var m, _results;

      if (!((this.descriptions != null) || (this.methods() != null))) {
        _results = [];
        for (m in this.descriptions) {
          _results.push(this.methods()[m].description = m);
        }
        return _results;
      }
    };

    PVMAjax.prototype.getMethods = function(success, error) {
      var _this = this;

      if (!error) {
        error = this.errorFunction;
      }
      if (!success) {
        success = this.successFunction;
      }
      return $.ajax({
        dataType: 'json',
        url: window.location.protocol + '//' + window.location.host + '/methods',
        success: function(r) {
          var m, _i, _len, _results;

          _results = [];
          for (_i = 0, _len = r.length; _i < _len; _i++) {
            m = r[_i];
            _results.push(_this.methods.push(new SOAPMethod(m)));
          }
          return _results;
        },
        error: error
      });
    };

    PVMAjax.prototype.loadDescriptions = function() {
      var _this = this;

      return $.ajax({
        dataType: 'json',
        url: window.location.protocol + '//' + window.location.host + '/pvm',
        data: {
          method: 'listApi',
          params: {}
        },
        success: function(r) {
          return success(r);
        },
        error: this.error
      });
    };

    return PVMAjax;

  })();

  window.PVMAjax = PVMAjax;

}).call(this);

/*
//@ sourceMappingURL=pvmajax.map
*/
