// Generated by CoffeeScript 1.6.2
(function() {
  var PVMAjax,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  PVMAjax = (function() {
    function PVMAjax(pvmProtocol, pvmURL, pvmRoute, pvmPort) {
      this.pvmProtocol = pvmProtocol;
      this.pvmURL = pvmURL;
      this.pvmRoute = pvmRoute;
      this.pvmPort = pvmPort;
      this.getMethods = __bind(this.getMethods, this);
      this.successFunction = __bind(this.successFunction, this);
      this.username = ko.observable('');
      this.password = ko.observable('');
      this.loginSuccess = ko.observable(false);
      this.methods = new Object();
      this.host = {
        protocol: window.location.protocol,
        host: window.location.host,
        route: "pvm"
      };
    }

    PVMAjax.prototype.successFunction = function(r) {
      console.log('success');
      return this.loginSuccess(true);
    };

    PVMAjax.prototype.errorFunction = function(r) {
      console.log('error');
      return console.log(r);
    };

    PVMAjax.prototype.login = function() {
      return $.ajax({
        dataType: 'json',
        url: this.host.protocol + '//' + this.host.host + '/init',
        data: {
          username: this.username(),
          password: this.password(),
          protocol: this.pvmProtocol,
          host: this.pvmURL,
          route: this.pvmRoute,
          port: this.pvmPort
        },
        success: this.getMethods,
        error: this.errorFunction
      });
    };

    PVMAjax.prototype.getMethods = function() {
      var error, success,
        _this = this;

      if (!error) {
        error = this.errorFunction;
      }
      if (!success) {
        success = this.successFunction;
      }
      return $.ajax({
        dataType: 'json',
        url: this.host.protocol + '//' + this.host.host + '/methods',
        success: function(r) {
          var m, _i, _len;

          for (_i = 0, _len = r.length; _i < _len; _i++) {
            m = r[_i];
            _this.methods[m.method] = new SOAPMethod(m);
          }
          return _this.successFunction(r);
        },
        error: this.errorFunction
      });
    };

    return PVMAjax;

  })();

  window.PVMAjax = PVMAjax;

}).call(this);

/*
//@ sourceMappingURL=pvmajax.map
*/
